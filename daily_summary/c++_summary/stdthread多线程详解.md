# `std::thread`多线程理解

[TOC]

# 1 线程理解

一个可执行程序即为一个进程，一个进程可以有一个或多个线程，其中有一个主线程。C++中的`main()`中的代码就是主线程要做的事。

多线程是并发执行的，线程一旦被创建就开始执行了，与`main()`是并发执行的，在遇到`join()`之前，可能一会执行`main`，一会执行`thread`，是不确定的，每次运行结果都可能不一样。

# 2 `thread::join()`

`join()`表示加入，汇合，即加入进程。一个进程可以包含多个线程，但是只有一个主线程，主线程执行完毕，进程也就结束了，传统的多线程变成中，是让主线程等待其他线程执行完毕，然后主线程才能结束，否则，主线程都结束了，其他线程还没结束，如果其他线程共享了主线程的资源那么，程序就会崩溃。`join()`简单来说就是告诉主线程，”我们是相关的，你必须等我执行完毕，才能继续执行“。一旦程序中调用`join()`，那么`main()`函数一旦执行完`join`，就会等待`thread`线程执行完毕再继续执行。

# 3 `thread::detach()`

  `detach()`表示分离，意思就是将子线程`thread`交给系统托管，与进程，主线程无关，在这种情况下主线程结束，子线程还在运行，容易引发一些问题，编程难度加大。

# 4 常见问题

## 4.1 不调用`join`和`detach`

如果子线程不调用`join`和`detach`会发生什么，系统会抛出异常。因为主线程结束了，进程也就结束了，但是子线程没有`detach`和主线程还是有关的，而主线程结束，子线程还没有结束，是不允许的。